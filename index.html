<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Asset Dashboard</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #0d1117;
  color: #e6edf3;
  margin: 20px;
}

h1 {
  text-align: center;
}

#status {
  text-align: center;
  color: #9ba3af;
  margin-bottom: 10px;
}

.section-title {
  margin: 25px 0 10px;
  font-size: 1.1em;
  color: #9ba3af;
}

.header,
.row {
  display: grid;
  grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1fr;
  gap: 10px;
  padding: 12px;
  border-radius: 8px;
  align-items: center;
}

.header {
  background: #161b22;
  font-weight: bold;
}

.row {
  background: #0f172a;
  margin-bottom: 8px;
}

.positive { color: #4caf50; font-weight: bold; }
.negative { color: #f44336; font-weight: bold; }
.neutral  { color: #9ba3af; }

@media (max-width: 700px) {
  .header { display: none; }
  .row { grid-template-columns: 1fr 1fr; }
}
</style>
</head>

<body>

<h1>Asset Dashboard</h1>
<div id="status">Initialisiere…</div>

<!-- Kryptowährungen -->
<div class="section-title">Kryptowährungen</div>
<div class="header">
  <div>Asset</div><div>USD</div><div>EUR</div><div>1h</div><div>24h</div><div>7d</div>
</div>
<div id="crypto"></div>

<!-- Edelmetalle -->
<div class="section-title">Edelmetalle</div>
<div class="header">
  <div>Asset</div><div>USD</div><div>EUR</div><div></div><div></div><div></div>
</div>
<div id="metals"></div>

<script>
const EUR_RATE = 0.93;

const cryptoIds = [
  "bitcoin",
  "ethereum",
  "solana",
  "binancecoin",
  "chainlink",
  "ripple"
];

let lastCryptoHTML = "";
let lastMetalHTML = "";

function pct(v) {
  if (v === null || v === undefined) return "–";
  const c = v >= 0 ? "positive" : "negative";
  return `<span class="${c}">${v.toFixed(2)}%</span>`;
}

function updateTime() {
  const now = new Date();
  const t = now.toLocaleTimeString("de-DE");
  document.getElementById("status").textContent =
    `Live – letzte Aktualisierung: ${t}`;
}

/* ===== Crypto ===== */
async function loadCrypto() {
  try {
    const url =
      "https://api.coingecko.com/api/v3/coins/markets" +
      "?vs_currency=usd" +
      "&ids=" + cryptoIds.join(",") +
      "&price_change_percentage=1h,24h,7d";

    const r = await fetch(url);
    if (!r.ok) throw new Error("Crypto API");

    const data = await r.json();
    let html = "";

    data.forEach(a => {
      html += `
      <div class="row">
        <div><strong>${a.name}</strong></div>
        <div>$${a.current_price.toFixed(2)}</div>
        <div>€${(a.current_price * EUR_RATE).toFixed(2)}</div>
        <div>${pct(a.price_change_percentage_1h_in_currency)}</div>
        <div>${pct(a.price_change_percentage_24h_in_currency)}</div>
        <div>${pct(a.price_change_percentage_7d_in_currency)}</div>
      </div>`;
    });

    lastCryptoHTML = html;
    document.getElementById("crypto").innerHTML = html;
    return true;
  } catch {
    if (lastCryptoHTML) {
      document.getElementById("crypto").innerHTML = lastCryptoHTML;
    }
    return false;
  }
}

/* ===== Metals ===== */
async function loadMetals() {
  try {
    const r = await fetch("https://api.metals.live/v1/spot");
    if (!r.ok) throw new Error("Metals API");

    const data = await r.json();
    let gold = null, silver = null;

    data.forEach(e => {
      if (e.gold !== undefined) gold = e.gold;
      if (e.silver !== undefined) silver = e.silver;
    });

    let html = "";

    if (gold !== null) {
      html += `
      <div class="row">
        <div><strong>Gold</strong></div>
        <div>$${gold.toFixed(2)}</div>
        <div>€${(gold * EUR_RATE).toFixed(2)}</div>
        <div class="neutral">–</div><div class="neutral">–</div><div class="neutral">–</div>
      </div>`;
    }

    if (silver !== null) {
      html += `
      <div class="row">
        <div><strong>Silber</strong></div>
        <div>$${silver.toFixed(2)}</div>
        <div>€${(silver * EUR_RATE).toFixed(2)}</div>
        <div class="neutral">–</div><div class="neutral">–</div><div class="neutral">–</div>
      </div>`;
    }

    lastMetalHTML = html;
    document.getElementById("metals").innerHTML = html;
    return true;
  } catch {
    if (lastMetalHTML) {
      document.getElementById("metals").innerHTML = lastMetalHTML;
    }
    return false;
  }
}

/* ===== Main ===== */
async function loadAll() {
  const c = await loadCrypto();
  const m = await loadMetals();

  if (c || m) {
    updateTime();
  } else {
    document.getElementById("status").textContent =
      "Daten momentan nicht verfügbar";
  }
}

loadAll();
setInterval(loadAll, 10000);
</script>

</body>
</html>
