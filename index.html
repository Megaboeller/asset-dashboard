<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Asset Dashboard</title>

<style>
/* ===== Grundlayout ===== */
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #0d1117;
  color: #e6edf3;
  margin: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

.section-title {
  margin: 25px 0 10px;
  font-size: 1.1em;
  color: #9ba3af;
}

/* ===== Tabellenlayout ===== */
.header,
.row {
  display: grid;
  grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1fr;
  gap: 10px;
  padding: 12px;
  border-radius: 8px;
  align-items: center;
}

.header {
  background: #161b22;
  font-weight: bold;
}

.row {
  background: #0f172a;
  margin-bottom: 8px;
}

/* ===== Farben ===== */
.positive {
  color: #4caf50;
  font-weight: bold;
}

.negative {
  color: #f44336;
  font-weight: bold;
}

.neutral {
  color: #9ba3af;
}

#status {
  text-align: center;
  color: #9ba3af;
  margin-bottom: 10px;
}

/* ===== Mobile ===== */
@media (max-width: 700px) {
  .header {
    display: none;
  }
  .row {
    grid-template-columns: 1fr 1fr;
  }
}
</style>
</head>

<body>

<h1>Asset Dashboard</h1>
<div id="status">Daten werden geladen…</div>

<!-- ===== Kryptowährungen ===== -->
<div class="section-title">Kryptowährungen</div>

<div class="header">
  <div>Asset</div>
  <div>Preis USD</div>
  <div>Preis EUR</div>
  <div>Δ 1h</div>
  <div>Δ 24h</div>
  <div>Δ 7d</div>
</div>

<div id="crypto"></div>

<!-- ===== Edelmetalle ===== -->
<div class="section-title">Edelmetalle</div>

<div class="header">
  <div>Asset</div>
  <div>Preis USD</div>
  <div>Preis EUR</div>
  <div></div>
  <div></div>
  <div></div>
</div>

<div id="metals"></div>

<script>
/* ===== Konfiguration ===== */
const EUR_RATE = 0.93; // grober USD → EUR Umrechnungskurs

const cryptoIds = [
  "bitcoin",
  "ethereum",
  "solana",
  "binancecoin",
  "chainlink",
  "ripple"
];

/* ===== Fallback-Speicher ===== */
let lastCryptoHTML = "";
let lastMetalHTML = "";

/* ===== Helfer ===== */
function pct(value) {
  if (value === null || value === undefined) return "–";
  const cls = value >= 0 ? "positive" : "negative";
  return `<span class="${cls}">${value.toFixed(2)}%</span>`;
}

/* ===== Kryptowährungen ===== */
async function loadCrypto() {
  const url =
    "https://api.coingecko.com/api/v3/coins/markets" +
    "?vs_currency=usd" +
    "&ids=" + cryptoIds.join(",") +
    "&price_change_percentage=1h,24h,7d";

  const response = await fetch(url);
  const data = await response.json();

  let html = "";

  data.forEach(asset => {
    html += `
      <div class="row">
        <div><strong>${asset.name}</strong></div>
        <div>$${asset.current_price.toFixed(2)}</div>
        <div>€${(asset.current_price * EUR_RATE).toFixed(2)}</div>
        <div>${pct(asset.price_change_percentage_1h_in_currency)}</div>
        <div>${pct(asset.price_change_percentage_24h_in_currency)}</div>
        <div>${pct(asset.price_change_percentage_7d_in_currency)}</div>
      </div>
    `;
  });

  lastCryptoHTML = html;
  document.getElementById("crypto").innerHTML = html;
}

/* ===== Edelmetalle ===== */
async function loadMetals() {
  const response = await fetch("https://api.metals.live/v1/spot");
  const data = await response.json();

  let goldPrice = null;
  let silverPrice = null;

  data.forEach(entry => {
    if (entry.gold !== undefined) goldPrice = entry.gold;
    if (entry.silver !== undefined) silverPrice = entry.silver;
  });

  let html = "";

  if (goldPrice !== null) {
    html += `
      <div class="row">
        <div><strong>Gold</strong></div>
        <div>$${goldPrice.toFixed(2)}</div>
        <div>€${(goldPrice * EUR_RATE).toFixed(2)}</div>
        <div class="neutral">–</div>
        <div class="neutral">–</div>
        <div class="neutral">–</div>
      </div>
    `;
  }

  if (silverPrice !== null) {
    html += `
      <div class="row">
        <div><strong>Silber</strong></div>
        <div>$${silverPrice.toFixed(2)}</div>
        <div>€${(silverPrice * EUR_RATE).toFixed(2)}</div>
        <div class="neutral">–</div>
        <div class="neutral">–</div>
        <div class="neutral">–</div>
      </div>
    `;
  }

  lastMetalHTML = html;
  document.getElementById("metals").innerHTML = html;
}

/* ===== Gesamt-Loader ===== */
async function loadAll() {
  try {
    await loadCrypto();
    await loadMetals();
    document.getElementById("status").textContent = "Live";
  } catch (e) {
    document.getElementById("status").textContent =
      "Daten aktuell nicht verfügbar – letzte Werte werden angezeigt";

    if (lastCryptoHTML) {
      document.getElementById("crypto").innerHTML = lastCryptoHTML;
    }
    if (lastMetalHTML) {
      document.getElementById("metals").innerHTML = lastMetalHTML;
    }
  }
}

/* ===== Start ===== */
loadAll();
setInterval(loadAll, 10000);
</script>

</body>
</html>
